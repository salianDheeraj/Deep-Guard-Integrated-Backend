services:
  # 1. deep-guard-backend (The Public API)
  - name: deep-guard-backend
    type: web
    plan: starter
    
    # FIX: Use 'runtime: docker' and specify paths directly under the service
    runtime: docker 
    dockerContext: . # This corresponds to your old 'context: .'
    dockerfilePath: Deep-Guard-Backend/Dockerfile
      
    envVars:
      # All environment variables listed as secure placeholders (sync: false)
      - key: PORT
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_ANON_KEY
        sync: false
      - key: NODE_ENV
        sync: false
      - key: JWT_SECRET
        sync: false
      - key: SUPABASE_BUCKET_NAME
        sync: false
      - key: JWT_REFRESH_SECRET
        sync: false
      - key: GOOGLE_CLIENT_ID
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: SERVICE_ROLE_KEY
        sync: false
      - key: FRONTEND_URL
        sync: false
      - key: ML_API_URL
        sync: false
      - key: ML_VIDEO_URL
        sync: false
      - key: ML_IMAGE_URL
        sync: false
      - key: client_SECRET
        sync: false
      - key: EMAIL_USER
        sync: false
      - key: EMAIL_PASSWORD
        sync: false
      - key: SMTP_HOST
        sync: false
      - key: SMTP_PORT
        sync: false
      - key: ENABLE_CSRF_CHECK
        sync: false

---

  # 2. deep-guard-ml-engine (The Internal Worker)
  - name: deep-guard-ml-engine
    # FIX: Use 'pserv' (Private Service)
    type: pserv 
    plan: starter
    
    # REMOVED: 'privateNetwork: true' is not a valid field.
    # The 'pserv' type already makes it private.
    routes:
      - type: private
        
    # FIX: Use 'runtime: docker' and specify paths directly under the service
    runtime: docker
    dockerContext: .
    dockerfilePath: Deep-Guard-ML-Engine/Dockerfile
      
    envVars:
      - key: PORT
        sync: false